<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mera Monitor - Application Usage Report</title>
    <style>
        /* A little bit of external styling for fonts and icons, the rest is inline */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding: 2rem;
            color: #333;
        }
    </style>
</head>
<body style="background-color: #f8f9fa; font-family: 'Inter', sans-serif;">

    <div id="app-container" style="max-width: 1200px; margin: auto; background: #fff; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border: 1px solid #e9ecef; padding: 24px;">

        <!-- Guidance Note -->
        <div id="guidance-note" style="background-color: #f1f3f5; padding: 12px 16px; border-radius: 6px; margin-bottom: 24px; font-size: 14px; color: #495057;">
            <strong>How to use:</strong> Select a filter, then type an application or website name in the search bar. Click on a suggestion to see the report.
        </div>

        <!-- Header Controls -->
        <div id="controls" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; flex-wrap: wrap; gap: 16px;">
             <div style="display: flex; align-items: center; gap: 8px; position: relative;">
                <select id="app-type-filter" style="padding: 10px; border-radius: 6px; border: 1px solid #ced4da; font-size: 14px; background-color: #f8f9fa;">
                    <option value="website" selected>Website</option>
                    <option value="application">Application</option>
                </select>
                <div style="position: relative;">
                    <input type="search" id="app-search" placeholder="Search Application or Website" style="padding: 10px 10px 10px 35px; border-radius: 6px; border: 1px solid #ced4da; font-size: 14px; min-width: 250px;" autocomplete="off">
                     <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" style="position: absolute; left: 12px; top: 12px; color: #6c757d;" viewBox="0 0 16 16">
                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                    </svg>
                    <!-- Suggestions Box -->
                    <div id="suggestions-box" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #ced4da; border-radius: 6px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 10; max-height: 200px; overflow-y: auto; margin-top: 4px;"></div>
                </div>
            </div>
            <div style="display: flex; align-items: center; gap: 10px;">
                <input type="date" id="start-date" style="padding: 10px; border-radius: 6px; border: 1px solid #ced4da; font-size: 14px;">
                <span style="color: #6c757d;">â†’</span>
                <input type="date" id="end-date" style="padding: 10px; border-radius: 6px; border: 1px solid #ced4da; font-size: 14px;">
                <button id="search-btn" style="padding: 10px 20px; border: none; background-color: #6D4BDB; color: white; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500;">Search</button>
            </div>
        </div>

        <!-- Report Table -->
        <div id="report-table">
            <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                <thead>
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <th style="text-align: left; padding: 12px; color: #6c757d; font-weight: 500; width: 30%;">TEAM MEMBER</th>
                        <th style="text-align: left; padding: 12px; color: #6c757d; font-weight: 500; width: 30%;">TOTAL TIME SPENT</th>
                        <th style="text-align: left; padding: 12px; color: #6c757d; font-weight: 500; width: 20%;">CATEGORY</th>
                        <th style="text-align: center; padding: 12px; color: #6c757d; font-weight: 500; width: 20%;">ACTION</th>
                    </tr>
                </thead>
                <tbody id="report-body">
                    <!-- Dynamic rows will be inserted here -->
                     <tr><td colspan="4" style="text-align:center; padding: 40px; color: #6c757d;">Please search for an application to see the report.</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // --- DUMMY DATA ---
        const usageData = [
            // ClickUp - Productive
            { user: 'Priya Sharma', app: 'https://app.clickup.com', startTime: '2025-10-14T09:05:00', endTime: '2025-10-14T11:30:00', category: 'Productive' },
            { user: 'Rohan Joshi', app: 'https://app.clickup.com', startTime: '2025-10-14T10:15:00', endTime: '2025-10-14T12:00:00', category: 'Productive' },
            { user: 'Priya Sharma', app: 'https://app.clickup.com', startTime: '2025-10-14T14:00:00', endTime: '2025-10-14T15:45:10', category: 'Productive' },
            { user: 'Priya Sharma', app: 'https://app.clickup.com', startTime: '2025-10-15T09:30:00', endTime: '2025-10-15T12:10:25', category: 'Productive' },
            { user: 'Ananya Rao', app: 'https://app.clickup.com', startTime: '2025-10-15T14:00:00', endTime: '2025-10-15T16:30:00', category: 'Productive' },
            { user: 'Rohan Joshi', app: 'https://app.clickup.com', startTime: '2025-10-16T11:00:00', endTime: '2025-10-16T11:45:55', category: 'Productive' },
            { user: 'Priya Sharma', app: 'https://app.clickup.com', startTime: '2025-10-17T10:00:00', endTime: '2025-10-17T12:30:00', category: 'Productive' },
            { user: 'Rohan Joshi', app: 'https://app.clickup.com', startTime: '2025-10-18T14:00:00', endTime: '2025-10-18T15:00:00', category: 'Productive' },

            // Design & Dev - Productive
            { user: 'Ananya Rao', app: 'Adobe Photoshop', startTime: '2025-10-14T11:00:00', endTime: '2025-10-14T13:20:30', category: 'Productive' },
            { user: 'Rohan Joshi', app: 'VS Code', startTime: '2025-10-15T09:00:00', endTime: '2025-10-15T17:00:00', category: 'Productive' },
            { user: 'Ananya Rao', app: 'Figma', startTime: '2025-10-17T09:00:00', endTime: '2025-10-17T11:00:00', category: 'Productive' },


            // Communication - Neutral
            { user: 'Priya Sharma', app: 'Slack', startTime: '2025-10-16T10:00:00', endTime: '2025-10-16T10:45:00', category: 'Neutral' },
            { user: 'Rohan Joshi', app: 'Gmail', startTime: '2025-10-16T10:00:00', endTime: '2025-10-16T10:15:00', category: 'Neutral' },
            { user: 'Ananya Rao', app: 'Slack', startTime: '2025-10-18T11:00:00', endTime: '2025-10-18T11:30:00', category: 'Neutral' },

            // Social Media - Unproductive
            { user: 'Rohan Joshi', app: 'youtube.com', startTime: '2025-10-15T13:00:00', endTime: '2025-10-15T13:45:00', category: 'Unproductive' },
            { user: 'Ananya Rao', app: 'youtube.com', startTime: '2025-10-16T12:00:00', endTime: '2025-10-16T12:30:00', category: 'Unproductive' },
            { user: 'Priya Sharma', app: 'facebook.com', startTime: '2025-10-17T15:00:00', endTime: '2025-10-17T15:25:00', category: 'Unproductive' }
        ];

        let uniqueApps = [];

        // --- UTILITY FUNCTIONS ---
        function formatDuration(seconds) {
            if (isNaN(seconds) || seconds < 0) return '0s';
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = Math.floor(seconds % 60);
            return `${h}hrs ${m}min ${s}sec`;
        }

        function isWebsite(appName) {
            return appName.startsWith('http') || appName.includes('.com');
        }

        // --- SEARCH SUGGESTIONS LOGIC ---
        const searchInput = document.getElementById('app-search');
        const suggestionsBox = document.getElementById('suggestions-box');
        const filterDropdown = document.getElementById('app-type-filter');

        function generateUniqueApps() {
            const allApps = usageData.map(item => item.app);
            uniqueApps = [...new Set(allApps)].sort();
        }

        function updateSuggestions() {
            const query = searchInput.value.toLowerCase();
            const filter = filterDropdown.value;
            suggestionsBox.innerHTML = '';

            if (!query) {
                suggestionsBox.style.display = 'none';
                return;
            }

            // 1. Filter by dropdown selection
            let typeFilteredApps;
            if (filter === 'application') {
                typeFilteredApps = uniqueApps.filter(app => !isWebsite(app));
            } else { // 'website' is the other option
                typeFilteredApps = uniqueApps.filter(app => isWebsite(app));
            }
            
            // 2. Filter by search query
            const queryFilteredApps = typeFilteredApps.filter(app => app.toLowerCase().includes(query));

            if (queryFilteredApps.length > 0) {
                queryFilteredApps.forEach(app => {
                    const suggestionItem = document.createElement('div');
                    suggestionItem.textContent = app;
                    suggestionItem.style.padding = '10px';
                    suggestionItem.style.cursor = 'pointer';
                    suggestionItem.onmouseover = () => suggestionItem.style.backgroundColor = '#f1f3f5';
                    suggestionItem.onmouseout = () => suggestionItem.style.backgroundColor = 'white';

                    suggestionItem.addEventListener('click', () => {
                        searchInput.value = app;
                        suggestionsBox.style.display = 'none';
                        document.getElementById('search-btn').click();
                    });

                    suggestionsBox.appendChild(suggestionItem);
                });
                suggestionsBox.style.display = 'block';
            } else {
                suggestionsBox.style.display = 'none';
            }
        }
        
        searchInput.addEventListener('input', updateSuggestions);
        filterDropdown.addEventListener('change', updateSuggestions);


        // Hide suggestions when clicking outside
        document.addEventListener('click', function(e) {
            if (!searchInput.contains(e.target) && !suggestionsBox.contains(e.target)) {
                suggestionsBox.style.display = 'none';
            }
        });
        
        // --- CORE LOGIC ---
        document.getElementById('search-btn').addEventListener('click', function() {
            const appName = document.getElementById('app-search').value.toLowerCase();
            const startDate = new Date(document.getElementById('start-date').value);
            const endDate = new Date(document.getElementById('end-date').value);
            endDate.setHours(23, 59, 59, 999); // Include the whole end day

            if (!appName) {
                alert('Please enter an application name.');
                return;
            }
             if (isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {
                alert('Please select a valid date range.');
                return;
            }

            const filteredData = usageData.filter(item => {
                const itemDate = new Date(item.startTime);
                const appMatch = item.app.toLowerCase() === appName; 
                const dateMatch = itemDate >= startDate && itemDate <= endDate;
                return appMatch && dateMatch;
            });

            const userReports = {};
            filteredData.forEach(item => {
                const duration = (new Date(item.endTime) - new Date(item.startTime)) / 1000;
                const dateKey = new Date(item.startTime).toISOString().split('T')[0];

                if (!userReports[item.user]) {
                    userReports[item.user] = {
                        totalDuration: 0,
                        category: item.category,
                        dailyUsage: {}
                    };
                }

                userReports[item.user].totalDuration += duration;
                
                if (!userReports[item.user].dailyUsage[dateKey]) {
                    userReports[item.user].dailyUsage[dateKey] = 0;
                }
                userReports[item.user].dailyUsage[dateKey] += duration;
            });

            renderReport(userReports);
        });

        function renderReport(userReports) {
            const reportBody = document.getElementById('report-body');
            reportBody.innerHTML = '';

            if (Object.keys(userReports).length === 0) {
                reportBody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding: 40px; color: #6c757d;">No usage data found for the selected criteria.</td></tr>';
                return;
            }

            const sortedUsers = Object.keys(userReports).sort();

            sortedUsers.forEach(user => {
                const report = userReports[user];
                
                const mainRow = document.createElement('tr');
                mainRow.style.borderBottom = '1px solid #e9ecef';
                mainRow.innerHTML = `
                    <td style="padding: 16px; font-weight: 500;">${user}</td>
                    <td style="padding: 16px;">${formatDuration(report.totalDuration)}</td>
                    <td style="padding: 16px; ">${report.category}</td>
                    <td style="padding: 16px; text-align: center;">
                        <button class="view-btn" style="background-color: #6D4BDB; color: white; border: none; padding: 8px 24px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; min-width: 80px;">
                            View
                        </button>
                    </td>
                `;
                
                const detailsRow = document.createElement('tr');
                detailsRow.classList.add('details-row');
                detailsRow.style.display = 'none';
                detailsRow.style.backgroundColor = '#f8f9fa';

                let detailsHtml = '<td colspan="4" style="padding: 16px 32px;">';
                const sortedDates = Object.keys(report.dailyUsage).sort();

                sortedDates.forEach(date => {
                    const correctedDate = new Date(new Date(date).getTime() + new Date(date).getTimezoneOffset() * 60000);
                    const day = String(correctedDate.getDate()).padStart(2, '0');
                    const month = String(correctedDate.getMonth() + 1).padStart(2, '0');
                    const year = correctedDate.getFullYear();
                    const formattedDate = `${day}/${month}/${year}`;
                    
                    const dailyTotalDuration = formatDuration(report.dailyUsage[date]);

                    detailsHtml += `<div style="padding: 4px 16px; display: flex; justify-content: space-between; align-items: center;">
                                      <strong style="font-weight: 600; color: #343a40;">${formattedDate}</strong>
                                      <span style="font-size: 13px; color: #495057;">${dailyTotalDuration}</span>
                                    </div>`;
                });

                detailsHtml += '</td>';
                detailsRow.innerHTML = detailsHtml;

                reportBody.appendChild(mainRow);
                reportBody.appendChild(detailsRow);
            });

            document.querySelectorAll('.view-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const detailsRow = this.closest('tr').nextElementSibling;
                    
                    if (detailsRow.style.display === 'none') {
                        detailsRow.style.display = 'table-row';
                        this.textContent = 'Hide';
                    } else {
                        detailsRow.style.display = 'none';
                        this.textContent = 'View';
                    }
                });
            });
        }

        function initializeReport() {
            generateUniqueApps();
            const today = new Date();
            const lastWeek = new Date();
            lastWeek.setDate(today.getDate() - 7); // Show a week's data by default
            document.getElementById('end-date').value = today.toISOString().split('T')[0];
            document.getElementById('start-date').value = lastWeek.toISOString().split('T')[0];
            document.getElementById('app-search').value = 'https://app.clickup.com';
            document.getElementById('search-btn').click();
        }

        initializeReport();

    </script>

</body>
</html>
